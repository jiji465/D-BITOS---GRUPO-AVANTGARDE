<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Estratégico | Sete Soluções</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #1e40af; --secondary: #3b82f6; --background: #f1f5f9; --card-bg: #ffffff;
            --text-primary: #111827; --text-secondary: #6b7280; --danger: #ef4444; --success: #22c55e;
            --warning: #f59e0b; --border-color: #e5e7eb;
        }
        body { font-family: 'Inter', sans-serif; background-color: var(--background); color: var(--text-primary); -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
        .sidebar { background-color: var(--card-bg); border-right: 1px solid var(--border-color); }
        .sidebar-link { transition: all 0.2s ease; color: #4b5563; }
        .sidebar-link.active, .sidebar-link:hover { background-color: var(--primary); color: #ffffff; transform: translateX(4px); box-shadow: 3px 0 15px -2px rgba(30, 64, 175, 0.3); }
        .sidebar-link.active i, .sidebar-link:hover i { color: #ffffff !important; }
        .kpi-card { background: var(--card-bg); border-radius: 0.75rem; box-shadow: 0 4px 12px -1px rgba(0,0,0,0.05); transition: all 0.3s ease; border: 1px solid var(--border-color); }
        .kpi-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px -3px rgba(0,0,0,0.07); }
        .chart-card { background-color: var(--card-bg); border-radius: 0.75rem; box-shadow: 0 4px 12px -1px rgba(0,0,0,0.05); padding: 1.5rem; border: 1px solid var(--border-color); }
        .table-container { border-radius: 0 0 0.75rem 0.75rem; overflow: hidden; border: 1px solid var(--border-color); border-top: none; }
        .table-header th { background-color: #f9fafb; color: var(--text-secondary); text-transform: uppercase; font-size: 0.75rem; letter-spacing: 0.05em; font-weight: 600; cursor: pointer; user-select: none; }
        .table-row:hover { background-color: #f3f4f6; }
        .filter-bar { background-color: #ffffff; padding: 1rem 1.5rem; border-radius: 0.75rem 0.75rem 0 0; border: 1px solid var(--border-color); box-shadow: 0 4px 12px -1px rgba(0,0,0,0.05); }
        .filter-input-group { position: relative; }
        .filter-input-group i { position: absolute; left: 0.75rem; top: 50%; transform: translateY(-50%); color: var(--text-secondary); pointer-events: none; }
        .filter-input { padding-left: 2.5rem; background-color: #f9fafb; border: 1px solid var(--border-color); border-radius: 0.5rem; transition: all 0.2s ease; }
        .filter-input:focus { background-color: #ffffff; border-color: var(--primary); box-shadow: 0 0 0 2px rgba(30, 64, 175, 0.2); outline: none; }
        .sort-icon { opacity: 0.4; transition: all 0.2s ease-in-out; }
        .sort-icon.active { opacity: 1; color: var(--primary); }
        .tab-button { padding: 0.75rem 1rem; font-weight: 600; color: var(--text-secondary); border-bottom: 3px solid transparent; transition: all 0.2s ease; }
        .tab-button:hover { color: var(--text-primary); }
        .tab-button.active { color: var(--primary); border-bottom-color: var(--primary); }
    </style>
</head>
<body class="flex min-h-screen">

    <aside id="sidebar" class="sidebar w-72 text-white flex-shrink-0 p-4 flex flex-col">
        <div class="flex items-center gap-3 mb-10 px-2">
            <div class="bg-blue-100 p-2 rounded-lg"><i data-lucide="shield-check" class="text-blue-800"></i></div>
            <h2 class="text-xl font-bold text-gray-800">Sete Soluções</h2>
        </div>
        <nav id="company-filters" class="flex flex-col gap-2 flex-1">
             <h3 class="text-sm font-semibold text-gray-400 uppercase px-3 mt-4 mb-2">Empresas</h3>
        </nav>
    </aside>

    <div class="flex-1 flex flex-col">
        <header class="bg-white/95 backdrop-blur-sm border-b border-gray-200 p-4 flex justify-between items-center sticky top-0 z-20">
             <h1 id="header-title" class="text-2xl font-bold text-gray-800">Painel Estratégico</h1>
        </header>
        
        <div class="px-8 border-b border-gray-200 bg-white/95 backdrop-blur-sm sticky top-[73px] z-10">
            <nav class="flex gap-4">
                <button class="tab-button active" data-tab="geral">Painel Estratégico</button>
                <button class="tab-button" data-tab="dre">Análise DRE</button>
                <button class="tab-button" data-tab="debitos">Débitos Fiscais</button>
            </nav>
        </div>

        <main class="flex-1 p-8">
            <div id="geral-content" class="tab-content">
                <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8">
                    <div class="kpi-card p-6"><div class="flex items-center justify-between"><h3 class="font-semibold text-gray-500 uppercase">Receita Total</h3><div class="bg-green-100 p-2 rounded-md"><i data-lucide="arrow-up-circle" class="text-green-600"></i></div></div><p id="geral-kpi-receita" class="text-3xl font-bold text-green-600 mt-2">R$ 0,00</p></div>
                    <div class="kpi-card p-6"><div class="flex items-center justify-between"><h3 class="font-semibold text-gray-500 uppercase">Despesa Total</h3><div class="bg-red-100 p-2 rounded-md"><i data-lucide="arrow-down-circle" class="text-red-600"></i></div></div><p id="geral-kpi-despesa" class="text-3xl font-bold text-red-600 mt-2">R$ 0,00</p></div>
                    <div class="kpi-card p-6"><div class="flex items-center justify-between"><h3 class="font-semibold text-gray-500 uppercase">Resultado Líquido</h3><div class="bg-blue-100 p-2 rounded-md"><i data-lucide="scale" class="text-blue-600"></i></div></div><p id="geral-kpi-resultado" class="text-3xl font-bold text-blue-800 mt-2">R$ 0,00</p></div>
                    <div class="kpi-card p-6"><div class="flex items-center justify-between"><h3 class="font-semibold text-gray-500 uppercase">Dívida Total</h3><div class="bg-orange-100 p-2 rounded-md"><i data-lucide="landmark" class="text-orange-600"></i></div></div><p id="geral-kpi-divida" class="text-3xl font-bold text-orange-600 mt-2">R$ 0,00</p></div>
                    <div class="kpi-card p-6"><div class="flex items-center justify-between"><h3 class="font-semibold text-gray-500 uppercase">Dívida Vencida</h3><div class="bg-red-100 p-2 rounded-md"><i data-lucide="alert-circle" class="text-red-600"></i></div></div><p id="geral-kpi-vencida" class="text-3xl font-bold text-red-600 mt-2">R$ 0,00</p></div>
                </section>
                <section class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <div class="chart-card flex flex-col"><h3 class="text-lg font-bold text-gray-800 mb-4">Resultado Líquido por Empresa</h3><div class="relative h-96"><canvas id="geral-resultado-empresa-chart"></canvas></div></div>
                    <div class="chart-card flex flex-col"><h3 class="text-lg font-bold text-gray-800 mb-4">Dívida Total por Empresa</h3><div class="relative h-96"><canvas id="geral-divida-empresa-chart"></canvas></div></div>
                </section>
            </div>
            
            <div id="dre-content" class="tab-content hidden">
                 <section class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="kpi-card p-6"><div class="flex items-center justify-between"><h3 class="font-semibold text-gray-500 uppercase">Total de Receitas</h3><div class="bg-green-100 p-2 rounded-md"><i data-lucide="arrow-up-circle" class="text-green-600"></i></div></div><p id="kpi-receitas" class="text-4xl font-bold text-green-600 mt-2">R$ 0,00</p></div>
                    <div class="kpi-card p-6"><div class="flex items-center justify-between"><h3 class="font-semibold text-gray-500 uppercase">Total de Despesas</h3><div class="bg-red-100 p-2 rounded-md"><i data-lucide="arrow-down-circle" class="text-red-600"></i></div></div><p id="kpi-despesas" class="text-4xl font-bold text-red-600 mt-2">R$ 0,00</p></div>
                    <div class="kpi-card p-6"><div class="flex items-center justify-between"><h3 class="font-semibold text-gray-500 uppercase">Resultado Líquido</h3><div class="bg-blue-100 p-2 rounded-md"><i data-lucide="scale" class="text-blue-600"></i></div></div><p id="kpi-resultado" class="text-4xl font-bold text-blue-800 mt-2">R$ 0,00</p></div>
                </section>
                 <section class="grid grid-cols-1 lg:grid-cols-5 gap-6 mb-8">
                    <div class="chart-card lg:col-span-2 flex flex-col"><h3 class="text-lg font-bold text-gray-800 mb-4">Composição das Despesas</h3><div class="relative h-96"><canvas id="expensesByTypeChart"></canvas></div></div>
                    <div class="chart-card lg:col-span-3 flex flex-col"><h3 class="text-lg font-bold text-gray-800 mb-4">Receitas vs. Despesas por Mês</h3><div class="relative h-96"><canvas id="revenueVsExpensesChart"></canvas></div></div>
                </section>
                <section>
                    <div class="filter-bar flex items-center justify-between gap-4 flex-wrap">
                        <h3 class="text-xl font-bold text-gray-800">Lançamentos</h3>
                        <div class="flex items-center gap-3 flex-wrap">
                            <div class="filter-input-group"><i data-lucide="calendar-days" class="w-4 h-4"></i><select id="filter-mes-conciliacao" class="filter-input text-gray-900 text-sm font-medium block w-full p-2 appearance-none"></select></div>
                            <div class="filter-input-group"><i data-lucide="filter" class="w-4 h-4"></i><select id="filter-categoria-conciliacao" class="filter-input text-gray-900 text-sm font-medium block w-full p-2 appearance-none"></select></div>
                            <button id="clear-filters-conciliacao-btn" class="p-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition" title="Limpar Filtros"><i data-lucide="rotate-ccw" class="w-5 h-5"></i></button>
                        </div>
                    </div>
                    <div class="table-container bg-white"><div class="overflow-x-auto"><table class="w-full text-sm text-left"><thead class="table-header"><tr><th class="px-6 py-4" data-sort-key-conc="mes"><div class="flex items-center gap-2">Mês <span class="sort-icon"></span></div></th><th class="px-6 py-4" data-sort-key-conc="categoria"><div class="flex items-center gap-2">Categoria <span class="sort-icon"></span></div></th><th class="px-6 py-4" data-sort-key-conc="tipo"><div class="flex items-center gap-2">Tipo <span class="sort-icon"></span></div></th><th class="px-6 py-4 text-right" data-sort-key-conc="valor"><div class="flex items-center justify-end gap-2">Valor <span class="sort-icon"></span></div></th></tr></thead><tbody id="conciliacao-table-body"></tbody></table></div></div>
                </section>
            </div>
            
            <div id="debitos-content" class="tab-content hidden">
                <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="kpi-card p-6"><div class="flex items-center justify-between"><h3 class="font-semibold text-gray-500 uppercase">Dívida Total</h3><div class="bg-orange-100 p-2 rounded-md"><i data-lucide="landmark" class="text-orange-600"></i></div></div><p id="kpi-total" class="text-4xl font-bold text-orange-600 mt-2">R$ 0,00</p></div>
                    <div class="kpi-card p-6"><div class="flex items-center justify-between"><h3 class="font-semibold text-gray-500 uppercase">Dívida Vencida</h3><div class="bg-red-100 p-2 rounded-md"><i data-lucide="alert-circle" class="text-red-600"></i></div></div><p id="kpi-vencido" class="text-4xl font-bold text-red-600 mt-2">R$ 0,00</p></div>
                    <div class="kpi-card p-6"><div class="flex items-center justify-between"><h3 class="font-semibold text-gray-500 uppercase">A Vencer</h3><div class="bg-yellow-100 p-2 rounded-md"><i data-lucide="calendar-check" class="text-yellow-600"></i></div></div><p id="kpi-avencer" class="text-4xl font-bold text-yellow-600 mt-2">R$ 0,00</p></div>
                    <div class="kpi-card p-6"><div class="flex items-center justify-between"><h3 class="font-semibold text-gray-500 uppercase">Dívida Vencida (%)</h3><div class="bg-red-100 p-2 rounded-md"><i data-lucide="pie-chart" class="text-red-600"></i></div></div><p id="kpi-perc-vencido" class="text-4xl font-bold text-red-600 mt-2">0%</p></div>
                </section>
                <section class="grid grid-cols-1 lg:grid-cols-5 gap-6 mb-8">
                    <div class="chart-card lg:col-span-2 flex flex-col"><h3 class="text-lg font-bold text-gray-800 mb-4">Composição da Dívida</h3><div class="relative h-96"><canvas id="debtByTypeChart"></canvas></div></div>
                    <div class="chart-card lg:col-span-3 flex flex-col"><h3 class="text-lg font-bold text-gray-800 mb-4">Dívida por Empresa</h3><div class="relative h-96"><canvas id="debtByCompanyChart"></canvas></div></div>
                </section>
                <section>
                    <div class="filter-bar flex items-center justify-between gap-4 flex-wrap">
                        <h3 class="text-xl font-bold text-gray-800">Detalhamento dos Débitos</h3>
                        <div class="flex items-center gap-3 flex-wrap">
                            <div class="filter-input-group"><i data-lucide="calendar" class="w-4 h-4"></i><input type="date" id="start-date-filter" class="filter-input p-2"></div>
                            <span class="text-gray-500">até</span>
                            <div class="filter-input-group"><i data-lucide="calendar" class="w-4 h-4"></i><input type="date" id="end-date-filter" class="filter-input p-2"></div>
                            <div class="filter-input-group"><i data-lucide="filter" class="w-4 h-4"></i><select id="filter-situacao" class="filter-input p-2 appearance-none"></select></div>
                            <button id="clear-filters-btn" class="p-2 bg-gray-200 rounded-lg hover:bg-gray-300 transition" title="Limpar Filtros"><i data-lucide="rotate-ccw" class="w-5 h-5"></i></button>
                        </div>
                    </div>
                    <div class="table-container bg-white"><div class="overflow-x-auto"><table class="w-full text-sm text-left"><thead class="table-header"><tr><th class="px-6 py-4" data-sort-key="nomeDebito"><div class="flex items-center gap-2">Débito<span class="sort-icon"></span></div></th><th class="px-6 py-4" data-sort-key="competencia"><div class="flex items-center gap-2">Competência<span class="sort-icon"></span></div></th><th class="px-6 py-4" data-sort-key="vencimento"><div class="flex items-center gap-2">Vencimento<span class="sort-icon"></span></div></th><th class="px-6 py-4" data-sort-key="situacao"><div class="flex items-center gap-2">Situação<span class="sort-icon"></span></div></th><th class="px-6 py-4 text-right" data-sort-key="valor"><div class="flex items-center justify-end gap-2">Valor<span class="sort-icon"></span></div></th></tr></thead><tbody id="debt-table-body"></tbody></table></div></div>
                </section>
            </div>
        </main>
    </div>
    
    <script>
        // =================================================================================
        // BASE DE DADOS
        // =================================================================================
        const debitosData = [
            { empresa: 'AGUIAR DUARTE SERVICOS MEDICOS LTDA', nomeDebito: 'IRPJ LUCRO PRESUMIDO (3ª Quota)', competencia: '1º trimestre', vencimento: '30/06/2025', valor: 6265.54, situacao: 'Vencido', tipo: 'IRPJ' }, { empresa: 'AGUIAR DUARTE SERVICOS MEDICOS LTDA', nomeDebito: 'IRPJ LUCRO PRESUMIDO (1ª Quota)', competencia: '2º trimestre', vencimento: '31/07/2025', valor: 23961.42, situacao: 'Vencido', tipo: 'IRPJ' }, { empresa: 'AGUIAR DUARTE SERVICOS MEDICOS LTDA', nomeDebito: 'CSLL DEMAIS (2ª Quota)', competencia: '1º trimestre', vencimento: '30/05/2025', valor: 3277.25, situacao: 'Vencido', tipo: 'CSLL' }, { empresa: 'AGUIAR DUARTE SERVICOS MEDICOS LTDA', nomeDebito: 'CSLL DEMAIS (3ª Quota)', competencia: '1º trimestre', vencimento: '30/06/2025', valor: 3245.93, situacao: 'Vencido', tipo: 'CSLL' }, { empresa: 'AGUIAR DUARTE SERVICOS MEDICOS LTDA', nomeDebito: 'CSLL DEMAIS (1ª Quota)', competencia: '2º trimestre', vencimento: '31/07/2025', valor: 9455.58, situacao: 'Vencido', tipo: 'CSLL' }, { empresa: 'AGUIAR DUARTE SERVICOS MEDICOS LTDA', nomeDebito: 'Contribuições previdênciaris e federais da folha', competencia: '06/2025', vencimento: '18/07/2025', valor: 8299.40, situacao: 'Vencido', tipo: 'Contribuições' }, { empresa: 'AGUIAR DUARTE SERVICOS MEDICOS LTDA', nomeDebito: 'IRPJ LUCRO PRESUMIDO (2ª Quota)', competencia: '2º trimestre', vencimento: '29/08/2025', valor: 22085.27, situacao: 'A vencer', tipo: 'IRPJ' }, { empresa: 'AGUIAR DUARTE SERVICOS MEDICOS LTDA', nomeDebito: 'CSLL DEMAIS (2ª Quota)', competencia: '2º trimestre', vencimento: '29/08/2025', valor: 8715.21, situacao: 'A vencer', tipo: 'CSLL' }, { empresa: 'AGUIAR DUARTE SERVICOS MEDICOS LTDA', nomeDebito: 'IRPJ LUCRO PRESUMIDO (3ª Quota)', competencia: '2º trimestre', vencimento: '30/09/2025', valor: 22085.27, situacao: 'A vencer', tipo: 'IRPJ' }, { empresa: 'AGUIAR DUARTE SERVICOS MEDICOS LTDA', nomeDebito: 'CSLL DEMAIS (3ª Quota)', competencia: '2º trimestre', vencimento: '30/09/2025', valor: 8715.21, situacao: 'A vencer', tipo: 'CSLL' }, { empresa: 'AGUIAR DUARTE SERVICOS MEDICOS LTDA', nomeDebito: 'ISS (DIVIDA ATIVA)', competencia: '03/2022', vencimento: '18/04/2022', valor: 4023.42, situacao: 'Vencido', tipo: 'ISS' }, { empresa: 'AVANT SPA LTDA', nomeDebito: 'IRPJ Lucro Presumido (3ª Quota)', competencia: '1º trimestre', vencimento: '30/06/2025', valor: 2122.03, situacao: 'Vencido', tipo: 'IRPJ' }, { empresa: 'AVANT SPA LTDA', nomeDebito: 'CSLL Demais (3ª Quota)', competencia: '1º trimestre', vencimento: '30/06/2025', valor: 1837.79, situacao: 'Vencido', tipo: 'CSLL' }, { empresa: 'AVANT SPA LTDA', nomeDebito: 'Contribuições previdênciaris e federais da folha', competencia: '06/2025', vencimento: '18/07/2025', valor: 3254.87, situacao: 'Vencido', tipo: 'Contribuições' }, { empresa: 'AVANT SPA LTDA', nomeDebito: 'IRPJ Lucro Presumido (1ª Quota)', competencia: '2º trimestre', vencimento: '31/07/2025', valor: 9985.35, situacao: 'Vencido', tipo: 'IRPJ' }, { empresa: 'AVANT SPA LTDA', nomeDebito: 'CSLL Demais (1ª Quota)', competencia: '2º trimestre', vencimento: '31/07/2025', valor: 4383.71, situacao: 'Vencido', tipo: 'CSLL' }, { empresa: 'AVANT SPA LTDA', nomeDebito: 'IRPJ Lucro Presumido (2ª Quota)', competencia: '2º trimestre', vencimento: '29/08/2025', valor: 9203.49, situacao: 'A vencer', tipo: 'IRPJ' }, { empresa: 'AVANT SPA LTDA', nomeDebito: 'CSLL Demais (2ª Quota)', competencia: '2º trimestre', vencimento: '29/08/2025', valor: 4040.45, situacao: 'A vencer', tipo: 'CSLL' }, { empresa: 'AVANT SPA LTDA', nomeDebito: 'IRPJ Lucro Presumido (3ª Quota)', competencia: '2º trimestre', vencimento: '30/09/2025', valor: 9203.49, situacao: 'A vencer', tipo: 'IRPJ' }, { empresa: 'AVANT SPA LTDA', nomeDebito: 'CSLL Demais (3ª Quota)', competencia: '2º trimestre', vencimento: '30/09/2025', valor: 4040.45, situacao: 'A vencer', tipo: 'CSLL' }, { empresa: 'AVANTGARDE CURSOS LTDA', nomeDebito: 'PIS', competencia: '03/2025', vencimento: '25/04/2025', valor: 132.76, situacao: 'Vencido', tipo: 'PIS/COFINS' }, { empresa: 'AVANTGARDE CURSOS LTDA', nomeDebito: 'COFINS', competencia: '03/2025', vencimento: '25/04/2025', valor: 612.78, situacao: 'Vencido', tipo: 'PIS/COFINS' }, { empresa: 'AVANTGARDE CURSOS LTDA', nomeDebito: 'Contribuições previdênciaris e federais da folha', competencia: '06/2025', vencimento: '18/07/2025', valor: 4588.75, situacao: 'Vencido', tipo: 'Contribuições' }, { empresa: 'AVANTGARDE CURSOS LTDA', nomeDebito: 'IRPJ LUCRO PRESUMIDO (1ª Quota)', competencia: '2º trimestre', vencimento: '31/07/2025', valor: 34014.45, situacao: 'Vencido', tipo: 'IRPJ' }, { empresa: 'AVANTGARDE CURSOS LTDA', nomeDebito: 'CSLL DEMAIS (1ª Quota)', competencia: '2º trimestre', vencimento: '31/07/2025', valor: 13223.20, situacao: 'Vencido', tipo: 'CSLL' }, { empresa: 'AVANTGARDE CURSOS LTDA', nomeDebito: 'IRPJ LUCRO PRESUMIDO (2ª Quota)', competencia: '2º trimestre', vencimento: '29/08/2025', valor: 31351.16, situacao: 'A vencer', tipo: 'IRPJ' }, { empresa: 'AVANTGARDE CURSOS LTDA', nomeDebito: 'CSLL DEMAIS (2ª Quota)', competencia: '2º trimestre', vencimento: '29/08/2025', valor: 12187.84, situacao: 'A vencer', tipo: 'CSLL' }, { empresa: 'AVANTGARDE CURSOS LTDA', nomeDebito: 'IRPJ LUCRO PRESUMIDO (3ª Quota)', competencia: '2º trimestre', vencimento: '30/09/2025', valor: 31351.16, situacao: 'A vencer', tipo: 'IRPJ' }, { empresa: 'AVANTGARDE CURSOS LTDA', nomeDebito: 'CSLL DEMAIS (3ª Quota)', competencia: '2º trimestre', vencimento: '30/09/2025', valor: 12187.84, situacao: 'A vencer', tipo: 'CSLL' }, { empresa: 'AVANTGARDE CURSOS LTDA', nomeDebito: 'ISS', competencia: '05/2025', vencimento: '10/06/2025', valor: 52267.14, situacao: 'Vencido', tipo: 'ISS' }, { empresa: 'AVANTGARDE CURSOS LTDA', nomeDebito: 'ISS', competencia: '06/2025', vencimento: '10/07/2025', valor: 195.67, situacao: 'Vencido', tipo: 'ISS' }, { empresa: 'INSTITUTO DE FISIOLOGIA HUMANA LTDA', nomeDebito: 'COFINS', competencia: '03/2025', vencimento: '25/04/2025', valor: 27170.99, situacao: 'Vencido', tipo: 'PIS/COFINS' }, { empresa: 'INSTITUTO DE FISIOLOGIA HUMANA LTDA', nomeDebito: 'IRPJ LUCRO PRESUMIDO (3ª Quota)', competencia: '1º trimestre', vencimento: '30/06/2025', valor: 30121.35, situacao: 'Vencido', tipo: 'IRPJ' }, { empresa: 'INSTITUTO DE FISIOLOGIA HUMANA LTDA', nomeDebito: 'Contribuições previdênciaris e federais da folha', competencia: '06/2025', vencimento: '18/07/2025', valor: 14756.70, situacao: 'Vencido', tipo: 'Contribuições' }, { empresa: 'INSTITUTO DE FISIOLOGIA HUMANA LTDA', nomeDebito: 'IRPJ LUCRO PRESUMIDO (1ª Quota)', competencia: '1º trimestre', vencimento: '31/07/2025', valor: 21297.62, situacao: 'Vencido', tipo: 'IRPJ' }, { empresa: 'INSTITUTO DE FISIOLOGIA HUMANA LTDA', nomeDebito: 'CSLL DEMAIS (1ª Quota)', competencia: '1º trimestre', vencimento: '31/07/2025', valor: 9732.62, situacao: 'Vencido', tipo: 'CSLL' }, { empresa: 'INSTITUTO DE FISIOLOGIA HUMANA LTDA', nomeDebito: 'IRPJ LUCRO PRESUMIDO (2ª Quota)', competencia: '2º trimestre', vencimento: '29/08/2025', valor: 19630.02, situacao: 'A vencer', tipo: 'IRPJ' }, { empresa: 'INSTITUTO DE FISIOLOGIA HUMANA LTDA', nomeDebito: 'CSLL DEMAIS (2ª Quota)', competencia: '2º trimestre', vencimento: '29/08/2025', valor: 8970.55, situacao: 'A vencer', tipo: 'CSLL' }, { empresa: 'INSTITUTO DE FISIOLOGIA HUMANA LTDA', nomeDebito: 'IRPJ LUCRO PRESUMIDO (3ª Quota)', competencia: '2º trimestre', vencimento: '30/09/2025', valor: 19630.02, situacao: 'A vencer', tipo: 'IRPJ' }, { empresa: 'INSTITUTO DE FISIOLOGIA HUMANA LTDA', nomeDebito: 'CSLL DEMAIS (3ª Quota)', competencia: '2º trimestre', vencimento: '30/09/2025', valor: 8970.55, situacao: 'A vencer', tipo: 'CSLL' }, { empresa: 'INSTITUTO DE FISIOLOGIA HUMANA LTDA', nomeDebito: 'Parcelamento 11/34', competencia: '06/2025', vencimento: '30/06/2025', valor: 576.43, situacao: 'Vencido', tipo: 'Parcelamento' }, { empresa: 'INSTITUTO DE FISIOLOGIA HUMANA LTDA', nomeDebito: 'Parcelamento 12/34', competencia: '07/2025', vencimento: '31/07/2025', valor: 576.43, situacao: 'Vencido', tipo: 'Parcelamento' }, { empresa: 'INSTITUTO DE FISIOLOGIA HUMANA LTDA', nomeDebito: 'Parcelamento 13/34', competencia: '08/2025', vencimento: '29/08/2025', valor: 576.43, situacao: 'A vencer', tipo: 'Parcelamento' }, { empresa: 'INSTITUTO DE FISIOLOGIA HUMANA LTDA', nomeDebito: 'ISS', competencia: '04/2024', vencimento: '10/05/2024', valor: 1053.49, situacao: 'Vencido', tipo: 'ISS' },
        ];
        const conciliacaoData = [
            { empresa: "AVANT SPA LTDA", mes: "Maio", categoria: "CUSTO DOS SERVIÇOS PRESTADOS", valor: 16739.27, tipo: "Custo" }, { empresa: "AVANT SPA LTDA", mes: "Maio", categoria: "DESPESA ADMINISTRATIVA", valor: 5193.52, tipo: "Despesa" }, { empresa: "AVANT SPA LTDA", mes: "Maio", categoria: "DESPESA COM DIRETORIA", valor: 5000, tipo: "Despesa" }, { empresa: "AVANT SPA LTDA", mes: "Maio", categoria: "DESPESA COM PESSOAL", valor: 12730.11, tipo: "Despesa" }, { empresa: "AVANT SPA LTDA", mes: "Maio", categoria: "DESPESA FINANCEIRA", valor: 20005, tipo: "Despesa" }, { empresa: "AVANT SPA LTDA", mes: "Maio", categoria: "DESPESA OPERACIONAL", valor: 1997.26, tipo: "Despesa" }, { empresa: "AVANT SPA LTDA", mes: "Maio", categoria: "DESPESA PREDIAL", valor: 10465.71, tipo: "Despesa" }, { empresa: "AVANT SPA LTDA", mes: "Maio", categoria: "EMPRÉSTIMO", valor: 4086.01, tipo: "Não Operacional" }, { empresa: "AVANT SPA LTDA", mes: "Maio", categoria: "IMPOSTO SOBRE VENDAS", valor: 12802.63, tipo: "Despesa" }, { empresa: "AVANT SPA LTDA", mes: "Maio", categoria: "RECEITA DE VENDAS", valor: 145682.99, tipo: "Receita" }, { empresa: "AVANT SPA LTDA", mes: "Maio", categoria: "TRANSFERENCIA ENTRE CONTAS", valor: 29308.5, tipo: "Não Operacional" }, { empresa: "AVANT SPA LTDA", mes: "Junho", categoria: "CUSTO DOS SERVIÇOS PRESTADOS", valor: 31638.5, tipo: "Custo" }, { empresa: "AVANT SPA LTDA", mes: "Junho", categoria: "DESPESA ADMINISTRATIVA", valor: 6432.1, tipo: "Despesa" }, { empresa: "AVANT SPA LTDA", mes: "Junho", categoria: "DESPESA COM DIRETORIA", valor: 55000, tipo: "Despesa" }, { empresa: "AVANT SPA LTDA", mes: "Junho", categoria: "DESPESA COM PESSOAL", valor: 11601.73, tipo: "Despesa" }, { empresa: "AVANT SPA LTDA", mes: "Junho", categoria: "DESPESA FINANCEIRA", valor: 111, tipo: "Despesa" }, { empresa: "AVANT SPA LTDA", mes: "Junho", categoria: "DESPESA OPERACIONAL", valor: 809.55, tipo: "Despesa" }, { empresa: "AVANT SPA LTDA", mes: "Junho", categoria: "DESPESA PREDIAL", valor: 10324.54, tipo: "Despesa" }, { empresa: "AVANT SPA LTDA", mes: "Junho", categoria: "EMPRÉSTIMO", valor: 4085.2, tipo: "Não Operacional" }, { empresa: "AVANT SPA LTDA", mes: "Junho", categoria: "IMPOSTO SOBRE VENDAS", valor: 7859.09, tipo: "Despesa" }, { empresa: "AVANT SPA LTDA", mes: "Junho", categoria: "RECEITA DE VENDAS", valor: 108662.02, tipo: "Receita" }, { empresa: "AVANT SPA LTDA", mes: "Junho", categoria: "TRANSFERENCIA ENTRE CONTAS", valor: 59000, tipo: "Não Operacional" }, { empresa: "AVANT SPA LTDA", mes: "Julho", categoria: "CUSTO DOS SERVIÇOS PRESTADOS", valor: 33032.6, tipo: "Custo" }, { empresa: "AVANT SPA LTDA", mes: "Julho", categoria: "DESPESA ADMINISTRATIVA", valor: 12144.86, tipo: "Despesa" }, { empresa: "AVANT SPA LTDA", mes: "Julho", categoria: "DESPESA COM DIRETORIA", valor: 10000, tipo: "Despesa" }, { empresa: "AVANT SPA LTDA", mes: "Julho", categoria: "DESPESA COM PESSOAL", valor: 15347.19, tipo: "Despesa" }, { empresa: "AVANT SPA LTDA", mes: "Julho", categoria: "DESPESA OPERACIONAL", valor: 2510.5, tipo: "Despesa" }, { empresa: "AVANT SPA LTDA", mes: "Julho", categoria: "DESPESA PREDIAL", valor: 10251.77, tipo: "Despesa" }, { empresa: "AVANT SPA LTDA", mes: "Julho", categoria: "EMPRÉSTIMO", valor: 4084.39, tipo: "Não Operacional" }, { empresa: "AVANT SPA LTDA", mes: "Julho", categoria: "IMPOSTO SOBRE VENDAS", valor: 6267.26, tipo: "Despesa" }, { empresa: "AVANT SPA LTDA", mes: "Julho", categoria: "RECEITA DE VENDAS", valor: 204200.72, tipo: "Receita" }, { empresa: "AVANT SPA LTDA", mes: "Julho", categoria: "TRANSFERENCIA ENTRE CONTAS", valor: 104800, tipo: "Não Operacional" }, { empresa: "AGUIAR DUARTE SERVICOS MEDICOS LTDA", mes: "Maio", categoria: "CUSTO DOS SERVIÇOS PRESTADOS", valor: 6855.38, tipo: "Custo" }, { empresa: "AGUIAR DUARTE SERVICOS MEDICOS LTDA", mes: "Maio", categoria: "DEDUÇÃO DE RECEITA BRUTA - ESTORNOS", valor: 6660, tipo: "Não Operacional" }, { empresa: "AGUIAR DUARTE SERVICOS MEDICOS LTDA", mes: "Maio", categoria: "DESPESA ADMINISTRATIVA", valor: 14369.77, tipo: "Despesa" }, { empresa: "AGUIAR DUARTE SERVICOS MEDICOS LTDA", mes: "Maio", categoria: "DESPESA COM PESSOAL", valor: 103153.5, tipo: "Despesa" }, { empresa: "AGUIAR DUARTE SERVICOS MEDICOS LTDA", mes: "Maio", categoria: "DESPESA PREDIAL", valor: 18724.75, tipo: "Despesa" }, { empresa: "AGUIAR DUARTE SERVICOS MEDICOS LTDA", mes: "Maio", categoria: "DISTRIBUIÇÃO DE LUCROS", valor: 27000, tipo: "Não Operacional" }, { empresa: "AGUIAR DUARTE SERVICOS MEDICOS LTDA", mes: "Maio", categoria: "EMPRÉSTIMO", valor: 6414.5, tipo: "Não Operacional" }, { empresa: "AGUIAR DUARTE SERVICOS MEDICOS LTDA", mes: "Maio", categoria: "IMPOSTO SOBRE VENDAS", valor: 25205.28, tipo: "Despesa" }, { empresa: "AGUIAR DUARTE SERVICOS MEDICOS LTDA", mes: "Maio", categoria: "RECEITA DE VENDAS", valor: 223054.63, tipo: "Receita" }, { empresa: "AGUIAR DUARTE SERVICOS MEDICOS LTDA", mes: "Junho", categoria: "CUSTO DOS SERVIÇOS PRESTADOS", valor: 32945.24, tipo: "Custo" }, { empresa: "AGUIAR DUARTE SERVICOS MEDICOS LTDA", mes: "Junho", categoria: "DEDUÇÃO DE RECEITA BRUTA - ESTORNOS", valor: 1691.5, tipo: "Não Operacional" }, { empresa: "AGUIAR DUARTE SERVICOS MEDICOS LTDA", mes: "Junho", categoria: "DESPESA ADMINISTRATIVA", valor: 22944.24, tipo: "Despesa" }, { empresa: "AGUIAR DUARTE SERVICOS MEDICOS LTDA", mes: "Junho", categoria: "DESPESA COM PESSOAL", valor: 50739.88, tipo: "Despesa" }, { empresa: "AGUIAR DUARTE SERVICOS MEDICOS LTDA", mes: "Junho", categoria: "DESPESA FINANCEIRA", valor: 111, tipo: "Despesa" }, { empresa: "AGUIAR DUARTE SERVICOS MEDICOS LTDA", mes: "Junho", categoria: "DESPESA PREDIAL", valor: 17334.84, tipo: "Despesa" }, { empresa: "AGUIAR DUARTE SERVICOS MEDICOS LTDA", mes: "Junho", categoria: "DISTRIBUIÇÃO DE LUCROS", valor: 45000, tipo: "Não Operacional" }, { empresa: "AGUIAR DUARTE SERVICOS MEDICOS LTDA", mes: "Junho", categoria: "EMPRÉSTIMO", valor: 6413.32, tipo: "Não Operacional" }, { empresa: "AGUIAR DUARTE SERVICOS MEDICOS LTDA", mes: "Junho", categoria: "IMPOSTO SOBRE VENDAS", valor: 17885.5, tipo: "Despesa" }, { empresa: "AGUIAR DUARTE SERVICOS MEDICOS LTDA", mes: "Junho", categoria: "OUTRAS RECEITAS", valor: 19000, tipo: "Receita" }, { empresa: "AGUIAR DUARTE SERVICOS MEDICOS LTDA", mes: "Junho", categoria: "RECEITA DE VENDAS", valor: 235209.81, tipo: "Receita" }, { empresa: "AGUIAR DUARTE SERVICOS MEDICOS LTDA", mes: "Junho", categoria: "TRANSFERENCIA ENTRE CONTAS", valor: 75000, tipo: "Não Operacional" }, { empresa: "AGUIAR DUARTE SERVICOS MEDICOS LTDA", mes: "Julho", categoria: "CUSTO DOS SERVIÇOS PRESTADOS", valor: 84382.72, tipo: "Custo" }, { empresa: "AGUIAR DUARTE SERVICOS MEDICOS LTDA", mes: "Julho", categoria: "DEDUÇÃO DE RECEITA BRUTA - ESTORNOS", valor: 12140.1, tipo: "Não Operacional" }, { empresa: "AGUIAR DUARTE SERVICOS MEDICOS LTDA", mes: "Julho", categoria: "DESPESA ADMINISTRATIVA", valor: 58201.66, tipo: "Despesa" }, { empresa: "AGUIAR DUARTE SERVICOS MEDICOS LTDA", mes: "Julho", categoria: "DESPESA COM PESSOAL", valor: 36391.42, tipo: "Despesa" }, { empresa: "AGUIAR DUARTE SERVICOS MEDICOS LTDA", mes: "Julho", categoria: "DESPESA PREDIAL", valor: 18920.38, tipo: "Despesa" }, { empresa: "AGUIAR DUARTE SERVICOS MEDICOS LTDA", mes: "Julho", categoria: "DISTRIBUIÇÃO DE LUCROS", valor: 104000, tipo: "Não Operacional" }, { empresa: "AGUIAR DUARTE SERVICOS MEDICOS LTDA", mes: "Julho", categoria: "EMPRÉSTIMO", valor: 6412.1, tipo: "Não Operacional" }, { empresa: "AGUIAR DUARTE SERVICOS MEDICOS LTDA", mes: "Julho", categoria: "ESTORNO DE PAGAMENTO", valor: 750, tipo: "Não Operacional" }, { empresa: "AGUIAR DUARTE SERVICOS MEDICOS LTDA", mes: "Julho", categoria: "IMPOSTO SOBRE VENDAS", valor: 17764.12, tipo: "Despesa" }, { empresa: "AGUIAR DUARTE SERVICOS MEDICOS LTDA", mes: "Julho", categoria: "RECEITA DE VENDAS", valor: 301417.26, tipo: "Receita" }, { empresa: "AGUIAR DUARTE SERVICOS MEDICOS LTDA", mes: "Julho", categoria: "TRANSFERENCIA ENTRE CONTAS", valor: 63900, tipo: "Não Operacional" }, { empresa: "AVANTGARDE CURSOS LTDA", mes: "Maio", categoria: "CUSTO DOS SERVIÇOS PRESTADOS", valor: 6237.27, tipo: "Custo" }, { empresa: "AVANTGARDE CURSOS LTDA", mes: "Maio", categoria: "DESPESA ADMINISTRATIVA", valor: 80560.51, tipo: "Despesa" }, { empresa: "AVANTGARDE CURSOS LTDA", mes: "Maio", categoria: "DESPESA COM PESSOAL", valor: 50199.86, tipo: "Despesa" }, { empresa: "AVANTGARDE CURSOS LTDA", mes: "Maio", categoria: "DESPESA FINANCEIRA", valor: 105.43, tipo: "Despesa" }, { empresa: "AVANTGARDE CURSOS LTDA", mes: "Maio", categoria: "DESPESA PREDIAL", valor: 11699.48, tipo: "Despesa" }, { empresa: "AVANTGARDE CURSOS LTDA", mes: "Maio", categoria: "DESPESAS COMERCIAIS", valor: 10527.6, tipo: "Despesa" }, { empresa: "AVANTGARDE CURSOS LTDA", mes: "Maio", categoria: "DISTRIBUIÇÃO DE LUCROS", valor: 128000, tipo: "Não Operacional" }, { empresa: "AVANTGARDE CURSOS LTDA", mes: "Maio", categoria: "IMPOSTO SOBRE VENDAS", valor: 14834.04, tipo: "Despesa" }, { empresa: "AVANTGARDE CURSOS LTDA", mes: "Maio", categoria: "RECEITA DE VENDAS", valor: 331720.84, tipo: "Receita" }, { empresa: "AVANTGARDE CURSOS LTDA", mes: "Maio", categoria: "EMPRÉSTIMO", valor: 10888.09, tipo: "Não Operacional" }, { empresa: "AVANTGARDE CURSOS LTDA", mes: "Junho", categoria: "CUSTO DOS SERVIÇOS PRESTADOS", valor: 27690.27, tipo: "Custo" }, { empresa: "AVANTGARDE CURSOS LTDA", mes: "Junho", categoria: "DESPESA ADMINISTRATIVA", valor: 123476.14, tipo: "Despesa" }, { empresa: "AVANTGARDE CURSOS LTDA", mes: "Junho", categoria: "DESPESA COM PESSOAL", valor: 54605.24, tipo: "Despesa" }, { empresa: "AVANTGARDE CURSOS LTDA", mes: "Junho", categoria: "DESPESA FINANCEIRA", valor: 56.82, tipo: "Despesa" }, { empresa: "AVANTGARDE CURSOS LTDA", mes: "Junho", categoria: "DESPESA PREDIAL", valor: 500.9, tipo: "Despesa" }, { empresa: "AVANTGARDE CURSOS LTDA", mes: "Junho", categoria: "DESPESAS COMERCIAIS", valor: 11050, tipo: "Despesa" }, { empresa: "AVANTGARDE CURSOS LTDA", mes: "Junho", categoria: "DISTRIBUIÇÃO DE LUCROS", valor: 10000, tipo: "Não Operacional" }, { empresa: "AVANTGARDE CURSOS LTDA", mes: "Junho", categoria: "IMPOSTO SOBRE VENDAS", valor: 38810.42, tipo: "Despesa" }, { empresa: "AVANTGARDE CURSOS LTDA", mes: "Junho", categoria: "OUTRAS RECEITAS", valor: 32000, tipo: "Receita" }, { empresa: "AVANTGARDE CURSOS LTDA", mes: "Junho", categoria: "RECEITA DE VENDAS", valor: 265970.49, tipo: "Receita" }, { empresa: "AVANTGARDE CURSOS LTDA", mes: "Junho", categoria: "TRANSFERENCIA ENTRE CONTAS", valor: 17000, tipo: "Não Operacional" }, { empresa: "AVANTGARDE CURSOS LTDA", mes: "Junho", categoria: "EMPRÉSTIMO", valor: 11348.62, tipo: "Não Operacional" }, { empresa: "AVANTGARDE CURSOS LTDA", mes: "Julho", categoria: "CUSTO DOS SERVIÇOS PRESTADOS", valor: 28290.28, tipo: "Custo" }, { empresa: "AVANTGARDE CURSOS LTDA", mes: "Julho", categoria: "DEDUÇÃO DE RECEITA BRUTA - ESTORNOS", valor: 6875, tipo: "Não Operacional" }, { empresa: "AVANTGARDE CURSOS LTDA", mes: "Julho", categoria: "DESPESA ADMINISTRATIVA", valor: 137165.53, tipo: "Despesa" }, { empresa: "AVANTGARDE CURSOS LTDA", mes: "Julho", categoria: "DESPESA COM PESSOAL", valor: 42919.86, tipo: "Despesa" }, { empresa: "AVANTGARDE CURSOS LTDA", mes: "Julho", categoria: "DESPESA FINANCEIRA", valor: 142.88, tipo: "Despesa" }, { empresa: "AVANTGARDE CURSOS LTDA", mes: "Julho", categoria: "DESPESA PREDIAL", valor: 6459.95, tipo: "Despesa" }, { empresa: "AVANTGARDE CURSOS LTDA", mes: "Julho", categoria: "DESPESAS COMERCIAIS", valor: 24908, tipo: "Despesa" }, { empresa: "AVANTGARDE CURSOS LTDA", mes: "Julho", categoria: "DISTRIBUIÇÃO DE LUCROS", valor: 103000, tipo: "Não Operacional" }, { empresa: "AVANTGARDE CURSOS LTDA", mes: "Julho", categoria: "IMPOSTO SOBRE VENDAS", valor: 952.89, tipo: "Despesa" }, { empresa: "AVANTGARDE CURSOS LTDA", mes: "Julho", categoria: "RECEITA DE VENDAS", valor: 472575.55, tipo: "Receita" }, { empresa: "AVANTGARDE CURSOS LTDA", mes: "Julho", categoria: "TRANSFERENCIA ENTRE CONTAS", valor: 134300, tipo: "Não Operacional" }, { empresa: "AVANTGARDE CURSOS LTDA", mes: "Julho", categoria: "EMPRÉSTIMO", valor: 10901.3, tipo: "Não Operacional" },
        ];
        
        // --- CÓDIGO DO DASHBOARD ---
        const state = { activeCompany: 'Todas', activeTab: 'geral', debitosSort: { key: 'vencimento', dir: 'asc' }, dreSort: { key: 'valor', dir: 'desc' } };
        const charts = {};
        const formatCurrency = (value) => new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value);
        const parseDebitosDate = (d) => { const [day, month, year] = d.split('/'); return new Date(year, month - 1, day); };

        const updateAll = () => {
            const companyFilter = (d) => state.activeCompany === 'Todas' || d.empresa.startsWith(state.activeCompany);
            const debitos = debitosData.filter(companyFilter);
            const dre = conciliacaoData.filter(companyFilter);
            updateGeral(debitos, dre);
            updateDRE(dre);
            updateDebitos(debitos);
        };
        const updateGeral = (debitos, dre) => {
            const totalReceitas = dre.filter(d => d.tipo === 'Receita').reduce((sum, item) => sum + item.valor, 0);
            const totalDespesas = dre.filter(d => d.tipo === 'Despesa' || d.tipo === 'Custo').reduce((sum, item) => sum + item.valor, 0);
            const resultadoLiquido = totalReceitas - totalDespesas;
            const dividaTotal = debitos.reduce((sum, item) => sum + item.valor, 0);
            const dividaVencida = debitos.filter(d => d.situacao === 'Vencido').reduce((sum, item) => sum + item.valor, 0);
            document.getElementById('geral-kpi-receita').textContent = formatCurrency(totalReceitas);
            document.getElementById('geral-kpi-despesa').textContent = formatCurrency(totalDespesas);
            document.getElementById('geral-kpi-resultado').textContent = formatCurrency(resultadoLiquido);
            document.getElementById('geral-kpi-divida').textContent = formatCurrency(dividaTotal);
            document.getElementById('geral-kpi-vencida').textContent = formatCurrency(dividaVencida);

            const resultadoPorEmpresa = conciliacaoData.reduce((acc, { empresa, tipo, valor }) => {
                if (!acc[empresa]) acc[empresa] = 0;
                if (tipo === 'Receita') acc[empresa] += valor;
                if (tipo === 'Despesa' || tipo === 'Custo') acc[empresa] -= valor;
                return acc;
            }, {});
            charts.geralResultado.data.labels = Object.keys(resultadoPorEmpresa);
            charts.geralResultado.data.datasets[0].data = Object.values(resultadoPorEmpresa);
            charts.geralResultado.update();
            
            const dividaPorEmpresa = debitosData.reduce((acc, { empresa, situacao, valor }) => {
                if (!acc[empresa]) acc[empresa] = { vencido: 0, aVencer: 0 };
                if (situacao === 'Vencido') acc[empresa].vencido += valor; else acc[empresa].aVencer += valor;
                return acc;
            }, {});
            charts.geralDivida.data.labels = Object.keys(dividaPorEmpresa);
            charts.geralDivida.data.datasets[0].data = Object.values(dividaPorEmpresa).map(d => d.vencido);
            charts.geralDivida.data.datasets[1].data = Object.values(dividaPorEmpresa).map(d => d.aVencer);
            charts.geralDivida.update();
        };
        const updateDRE = (data) => {
            const mesFilter = document.getElementById('filter-mes-conciliacao').value;
            const catFilter = document.getElementById('filter-categoria-conciliacao').value;
            const filtered = data.filter(d => (mesFilter === 'Todos' || d.mes === mesFilter) && (catFilter === 'Todos' || d.categoria === catFilter));
            
            const totalReceitas = data.filter(d => d.tipo === 'Receita').reduce((sum, i) => sum + i.valor, 0);
            const totalDespesas = data.filter(d => d.tipo === 'Despesa' || d.tipo === 'Custo').reduce((sum, i) => sum + i.valor, 0);
            document.getElementById('kpi-receitas').textContent = formatCurrency(totalReceitas);
            document.getElementById('kpi-despesas').textContent = formatCurrency(totalDespesas);
            document.getElementById('kpi-resultado').textContent = formatCurrency(totalReceitas - totalDespesas);

            const expensesByType = filtered.filter(d => d.tipo === 'Despesa' || d.tipo === 'Custo').reduce((acc, d) => { acc[d.categoria] = (acc[d.categoria] || 0) + d.valor; return acc; }, {});
            charts.expensesByType.data.labels = Object.keys(expensesByType);
            charts.expensesByType.data.datasets[0].data = Object.values(expensesByType);
            charts.expensesByType.update();

            const monthlySummary = data.reduce((acc, d) => {
                if (!acc[d.mes]) acc[d.mes] = { receitas: 0, despesas: 0 };
                if (d.tipo === 'Receita') acc[d.mes].receitas += d.valor;
                if (d.tipo === 'Despesa' || d.tipo === 'Custo') acc[d.mes].despesas += d.valor;
                return acc;
            }, {});
            const months = Object.keys(monthlySummary).sort((a, b) => new Date(`01 ${a} 2025`) - new Date(`01 ${b} 2025`));
            charts.revenueVsExpenses.data.labels = months;
            charts.revenueVsExpenses.data.datasets[0].data = months.map(m => monthlySummary[m].receitas);
            charts.revenueVsExpenses.data.datasets[1].data = months.map(m => monthlySummary[m].despesas);
            charts.revenueVsExpenses.update();

            const tableBody = document.getElementById('conciliacao-table-body');
            tableBody.innerHTML = filtered.sort((a,b) => (a[state.dreSort.key] > b[state.dreSort.key] ? 1 : -1) * (state.dreSort.dir === 'asc' ? 1 : -1)).map(d => `<tr class="table-row border-b"><td class="px-6 py-4">${d.mes}</td><td class="px-6 py-4 font-semibold">${d.categoria}</td><td class="px-6 py-4"><span class="px-2 py-1 text-xs font-medium rounded-full ${d.tipo === 'Receita' ? 'bg-green-100 text-green-700' : (d.tipo === 'Despesa' ? 'bg-red-100 text-red-700' : (d.tipo === 'Custo' ? 'bg-yellow-100 text-yellow-700' : 'bg-gray-100 text-gray-700'))}">${d.tipo}</span></td><td class="px-6 py-4 text-right font-bold ${d.tipo === 'Receita' ? 'text-green-600' : 'text-red-600'}">${d.tipo === 'Receita' ? '+' : '-'} ${formatCurrency(d.valor)}</td></tr>`).join('');
        };
        const updateDebitos = (data) => {
            const situacaoFilter = document.getElementById('filter-situacao').value;
            const startDate = document.getElementById('start-date-filter').value ? new Date(document.getElementById('start-date-filter').value + 'T00:00:00') : null;
            const endDate = document.getElementById('end-date-filter').value ? new Date(document.getElementById('end-date-filter').value + 'T23:59:59') : null;
            const filtered = data.filter(d => (!startDate || parseDebitosDate(d.vencimento) >= startDate) && (!endDate || parseDebitosDate(d.vencimento) <= endDate) && (situacaoFilter === 'Todos' || d.situacao === situacaoFilter));
            
            const dividaTotal = data.reduce((sum, item) => sum + item.valor, 0);
            const dividaVencida = data.filter(d => d.situacao === 'Vencido').reduce((sum, item) => sum + item.valor, 0);
            const dividaAVencer = dividaTotal - dividaVencida;
            document.getElementById('kpi-total').textContent = formatCurrency(dividaTotal);
            document.getElementById('kpi-vencido').textContent = formatCurrency(dividaVencida);
            document.getElementById('kpi-avencer').textContent = formatCurrency(dividaAVencer);
            document.getElementById('kpi-perc-vencido').textContent = dividaTotal > 0 ? `${((dividaVencida / dividaTotal) * 100).toFixed(0)}%` : '0%';

            const byType = filtered.reduce((acc, d) => { acc[d.tipo] = (acc[d.tipo] || 0) + d.valor; return acc; }, {});
            charts.debtByType.data.labels = Object.keys(byType);
            charts.debtByType.data.datasets[0].data = Object.values(byType);
            charts.debtByType.update();

            const byCompany = data.reduce((acc, { empresa, situacao, valor }) => {
                if (!acc[empresa]) acc[empresa] = { vencido: 0, aVencer: 0 };
                if (situacao === 'Vencido') acc[empresa].vencido += valor; else acc[empresa].aVencer += valor;
                return acc;
            }, {});
            charts.debtByCompany.data.labels = Object.keys(byCompany);
            charts.debtByCompany.data.datasets[0].data = Object.values(byCompany).map(d => d.vencido);
            charts.debtByCompany.data.datasets[1].data = Object.values(byCompany).map(d => d.aVencer);
            charts.debtByCompany.update();
            
            const tableBody = document.getElementById('debt-table-body');
            tableBody.innerHTML = filtered.sort((a,b) => (a[state.debitosSort.key] > b[state.debitosSort.key] ? 1 : -1) * (state.debitosSort.dir === 'asc' ? 1 : -1)).map(d => `<tr class="table-row border-b"><td class="px-6 py-4 font-semibold">${d.nomeDebito}</td><td class="px-6 py-4">${d.competencia}</td><td class="px-6 py-4">${d.vencimento}</td><td class="px-6 py-4"><span class="px-2.5 py-1 text-xs font-semibold rounded-full ${d.situacao === 'Vencido' ? 'bg-red-100 text-red-800' : 'bg-yellow-100 text-yellow-800'}">${d.situacao}</span></td><td class="px-6 py-4 text-right font-bold">${formatCurrency(d.valor)}</td></tr>`).join('');
        };
        
        const setupEventListeners = () => {
            document.querySelectorAll('.tab-button').forEach(b => b.addEventListener('click', () => {
                state.activeTab = b.dataset.tab;
                document.getElementById('header-title').textContent = b.textContent;
                document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                b.classList.add('active');
                document.querySelectorAll('.tab-content').forEach(c => c.classList.toggle('hidden', c.id !== `${state.activeTab}-content`));
                updateSidebar();
                updateAll();
            }));
            document.querySelectorAll('#filter-mes-conciliacao, #filter-categoria-conciliacao').forEach(el => el.addEventListener('change', updateAll));
            document.getElementById('clear-filters-conciliacao-btn').addEventListener('click', () => { document.getElementById('filter-mes-conciliacao').value = 'Todos'; document.getElementById('filter-categoria-conciliacao').value = 'Todos'; updateAll(); });
            document.querySelectorAll('#start-date-filter, #end-date-filter, #filter-situacao').forEach(el => el.addEventListener('change', updateAll));
            document.getElementById('clear-filters-btn').addEventListener('click', () => { document.getElementById('start-date-filter').value = ''; document.getElementById('end-date-filter').value = ''; document.getElementById('filter-situacao').value = 'Todos'; updateAll(); });
            document.querySelectorAll('#conciliacao-content .table-header th').forEach(th => th.addEventListener('click', () => { const key = th.dataset.sortKeyConc; if (key) { state.dreSort.dir = state.dreSort.key === key && state.dreSort.dir === 'asc' ? 'desc' : 'asc'; state.dreSort.key = key; updateAll(); }}));
            document.querySelectorAll('#debitos-content .table-header th').forEach(th => th.addEventListener('click', () => { const key = th.dataset.sortKey; if (key) { state.debitosSort.dir = state.debitosSort.key === key && state.debitosSort.dir === 'asc' ? 'desc' : 'asc'; state.debitosSort.key = key; updateAll(); }}));
        };

        const updateSidebar = () => {
            const data = state.activeTab === 'debitos' ? debitosData : conciliacaoData;
            const companies = ['Todas', ...new Set(data.map(d => d.empresa))];
            const filtersContainer = document.getElementById('company-filters');
            filtersContainer.innerHTML = `<h3 class="text-sm font-semibold text-gray-400 uppercase px-3 mt-4 mb-2">Empresas</h3>` + companies.map(c => `<a href="#" class="sidebar-link flex items-center gap-3 rounded-md px-3 py-2.5 text-sm font-medium ${c === state.activeCompany ? 'active' : ''}" data-company="${c}"><i data-lucide="building-2" class="w-5 h-5 text-gray-500"></i><span>${c === 'Todas' ? 'Visão Geral' : c}</span></a>`).join('');
            filtersContainer.querySelectorAll('.sidebar-link').forEach(link => link.addEventListener('click', (e) => { e.preventDefault(); state.activeCompany = link.dataset.company; updateAll(); updateSidebar(); }));
            lucide.createIcons();
        };

        const createChart = (id, type, data, options) => new Chart(document.getElementById(id).getContext('2d'), { type, data, options });

        window.onload = () => {
            Chart.defaults.font.family = 'Inter'; Chart.defaults.color = '#6b7280';
            charts.geralResultado = createChart('geral-resultado-empresa-chart', 'bar', { datasets: [{ label: 'Resultado Líquido', backgroundColor: 'rgba(30, 64, 175, 0.8)', borderRadius: 4 }] }, { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true } } });
            charts.geralDivida = createChart('geral-divida-empresa-chart', 'bar', { datasets: [{ label: 'Vencido', backgroundColor: 'rgba(239, 68, 68, 0.8)', borderRadius: 2 }, { label: 'A Vencer', backgroundColor: 'rgba(245, 158, 11, 0.8)', borderRadius: 2 }] }, { responsive: true, maintainAspectRatio: false, scales: { x: { stacked: true }, y: { stacked: true, beginAtZero: true } } });
            charts.debtByType = createChart('debtByTypeChart', 'doughnut', { datasets: [{ backgroundColor: ['#1e40af', '#1d4ed8', '#2563eb', '#3b82f6', '#60a5fa', '#9ca3af', '#6b7280'], borderWidth: 4 }] }, { responsive: true, maintainAspectRatio: false, cutout: '70%', plugins: { legend: { position: 'bottom' } } });
            charts.debtByCompany = createChart('debtByCompanyChart', 'bar', { datasets: [{ label: 'Vencido', backgroundColor: 'rgba(239, 68, 68, 0.8)', borderRadius: 2 }, { label: 'A Vencer', backgroundColor: 'rgba(245, 158, 11, 0.8)', borderRadius: 2 }] }, { responsive: true, maintainAspectRatio: false, scales: { x: { stacked: true }, y: { stacked: true } } });
            charts.expensesByType = createChart('expensesByTypeChart', 'doughnut', { datasets: [{ backgroundColor: ['#ef4444', '#f87171', '#fca5a5', '#fecaca', '#fee2e2'], borderWidth: 4 }] }, { responsive: true, maintainAspectRatio: false, cutout: '70%', plugins: { legend: { position: 'bottom' } } });
            charts.revenueVsExpenses = createChart('revenueVsExpensesChart', 'bar', { datasets: [{ label: 'Receitas', backgroundColor: 'rgba(34, 197, 94, 0.8)', borderRadius: 4 }, { label: 'Despesas', backgroundColor: 'rgba(239, 68, 68, 0.8)', borderRadius: 4 }] }, { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true } } });
            
            document.getElementById('filter-situacao').innerHTML = ['Todos', ...new Set(debitosData.map(d => d.situacao))].map(v => `<option value="${v}">${v}</option>`).join('');
            document.getElementById('filter-mes-conciliacao').innerHTML = ['Todos', ...new Set(conciliacaoData.map(d => d.mes))].map(v => `<option value="${v}">${v}</option>`).join('');
            document.getElementById('filter-categoria-conciliacao').innerHTML = ['Todos', ...new Set(conciliacaoData.map(d => d.categoria))].map(v => `<option value="${v}">${v}</option>`).join('');

            setupEventListeners();
            updateSidebar();
            updateAll();
        };
    </script>
</body>
</html>
